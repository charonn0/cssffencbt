#tag ModuleProtected Module Globals	#tag Method, Flags = &h0		Sub CarbonBringAllWindowsToFront()		  // Modified 2/3/2002 by Kevin Ballard		  		  // 68k Compatible		  		  dim m as memoryBlock		  dim err as integer		  		  #if TargetMacOS then		    Declare Function SetFrontProcess Lib "Carbon" (PSN as ptr) as Integer		    		    		    m = GetCurrentProcess		    		    err = SetFrontProcess(m)		  #endif		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function GetCurrentProcess() As MemoryBlock		  // Added 12/15/2001 by Kevin Ballard		  // Modified on 12/16/2001 by Jarvis Badgley		  // Modified 2/3/2002 by Kevin Ballard		  // Modified 2/11/2002 by Kevin Ballard		  		  // 68k Compatible		  		  #if TargetMacOS then		    Declare Sub GetMe lib "Carbon" Alias "GetCurrentProcess" (PSN As Ptr)		    		    		    // Returns the reference to the current process		    		    Dim proc As MemoryBlock, err as integer		    		    proc = NewMemoryBlock(8)		    		    GetMe proc		    		    Return proc		  #endif		End Function	#tag EndMethod	#tag Method, Flags = &h0		Sub NotifyStart(text as string)		  // Added 11/25/2001 by Jarvis Badgley		  		  // 68k Compatible		  		  #if TargetMacOS		    		    dim err As integer		    if NotificationHandle=nil then		      NotificationHandle=newMemoryBlock(36)		      NotificationFlag=false		    end		    if NotificationFlag then		      return		    end		    NotificationFlag=true		    		    NotificationHandle.short(4) = 8		    NotificationHandle.short(14) = 1		    NotificationHandle.long(16) = 0		    NotificationHandle.long(20) = 0		    NotificationHandle.long(28) = 0		    NotificationHandle.long(32) = 0		    		    if text = "" then		      NotificationHandle.long(24) = 0		    else		      Notify_messageHolder = NewMemoryBlock(len(text) + 1)		      Notify_messageHolder.pstring(0) = text		      		      NotificationHandle.ptr(24) = Notify_messageHolder		    end if		    		    Declare Function NMInstall Lib "Carbon" (nmReqPtr as Ptr) as Short		    		    		    err= NMInstall(NotificationHandle)		    		  #endif		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub NotifyStop()		  // Added 11/25/2001 by Jarvis Badgley		  // Modified 12/19/02 by Kevin Ballard		  		  		  #if TargetMacOS		    		    dim err as integer		    		    Declare Function NMRemove Lib "Carbon" (nmReqPtr as Ptr) as Short Inline68K("205FA05F3E80")		    		    		    if NotificationHandle<>nil and NotificationFlag then		      err= NMRemove(NotificationHandle)		    end		    NotificationFlag=false		    		  #endif		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub PostGrowl(Notification As String)		  //Posts notification depending on the		  Dim n As New GrowlNotificationMBS		  		  n.Name = Notification		  n.Title = Notification + "!"		  Select Case Notification		  Case "Encryption Finished"		    n.Description = "Your encryption has finished successfully."		  Case "Decryption Finished"		    n.Description = "Your decryption has finished successfully."		  Case "Encryption Error"		    n.Description = "An error was encountered during the encryption process."		  Case "Decryption Error"		    n.Description = "An error was encountered during the decryption process."		  End Select		  		  n.PostNotification		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub CarbonResize(w as window, width as integer, height as integer, align as integer)		  // Added 11/13/2001 by Jarvis Badgley		  // Edited 12/05/2001 by Jarvis Badgley		  // Modified 2/3/2002 by Kevin Ballard		  // ---		  // Rewritten 2/22/2002 by Kevin Ballard		  // Based off of code by Jean-Francois Roy <bahamut@mac.com>		  // ---		  // Modified 8/23/02 by Kevin Ballard		  // Modified 12/14/02 by Pedro fp <mail@pedro.net.au>		  // Modified 12/14/02 by Kevin Ballard		  //		  // Align numbers:		  //     0) Lock upper left		  //     1) Lock upper right		  //     2) Lock lower left		  //     3) Lock lower right		  //     4) Lock top center		  //     5) Lock left center		  //     6) Lock bottom center		  //     7) Lock right center		  		  #if TargetMacOS		    		    dim err, t, l as integer		    dim rect as MemoryBlock		    		    Declare Function TransitionWindow Lib "Carbon" (window as WindowPtr, effect as Integer, action as Integer, rect as Ptr) as Integer		    Declare Function GetWindowBounds  Lib "Carbon" (window As WindowPtr, regionCode As Integer, globalBounds As Ptr) as Integer		    		    		    // we get the old window region		    rect = NewMemoryBlock(8)		    err = GetWindowBounds(w, 32, rect)		    		    t = w.Top // Need to know where the top and left of the window go		    l = w.Left		    Select Case align // Use deltas in measurements, not absolutes		    Case 0 // Lock upper left		      rect.Short(4) = rect.Short(4) + (height - w.height)		      rect.Short(6) = rect.Short(6) + (width - w.width)		    Case 1 // Lock upper right		      rect.Short(2) = rect.Short(2) - (width - w.width)		      rect.Short(4) = rect.Short(4) + (height - w.height)		      l = l - (width - w.width) // Left side moves		    Case 2 // Lock lower left		      rect.Short(0) = rect.Short(0) - (height - w.height)		      rect.Short(6) = rect.Short(6) + (width - w.width)		      t = t - (height - w.height) // Top side moves		    Case 3 // Lock lower right		      rect.Short(0) = rect.Short(0) - (height - w.height)		      rect.Short(2) = rect.Short(2) - (width - w.width)		      t = t - (height - w.height) // Top side moves		      l = l - (width - w.width) // Left side moves		    Case 4 // Lock top center		      rect.Short(2) = rect.Short(2) - (width - w.width) / 2		      rect.Short(4) = rect.Short(4) + (height - w.height)		      rect.Short(6) = rect.Short(6) + (width - w.width) / 2		      l = l - (width - w.width)/2 // Both sides move		    Case 5 // Lock left center		      rect.Short(0) = rect.Short(0) - (height - w.height) / 2		      rect.Short(4) = rect.Short(4) + (height - w.height) / 2		      rect.Short(6) = rect.Short(6) + (width - w.width)		      t = t - (height - w.height) / 2 // Top moves		    Case 6 // Lock bottom center		      rect.Short(0) = rect.Short(0) - (height - w.height)		      rect.Short(2) = rect.Short(2) - (width - w.width) / 2		      rect.Short(6) = rect.Short(6) + (width - w.width) / 2		      t = t - (height - w.height) // Top moves		      l = l - (width - w.width) / 2 // Left moves		    Case 7 // Lock right center		      rect.Short(0) = rect.Short(0) - (height - w.height) / 2		      rect.Short(2) = rect.Short(2) - (width - w.width)		      rect.Short(4) = rect.Short(4) + (height - w.height) / 2		      t = t - (height - w.height) / 2// Top moves		      l = l - (width - w.width) // Left moves		    End Select // If none of these, don't change		    		    // transition		    err = TransitionWindow(w, 3, 4, rect)		    		    // have to manually set the window's new height after resizing the window		    w.Top = t		    w.Left = l		    w.Width = width		    w.Height = height		    		    w.refresh		    		  #endif // Target68k		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub InitializeSparkle()		  //Set the appcast feed depending on whether or not it is a beta build.		  #If BitClamp.IsBetaBuild Then		    Sparkle.UserDefault("SUFeedURL") = "http://www.BitClamp.com/BitClampBetas.xml"		  #Else		    Sparkle.UserDefault("SUFeedURL") = "http://www.BitClamp.com/BitClampAppCast.xml"		  #EndIf		  //Initialize the sparkle framework depending on whether or not we are debugging and set user defaults.		  #If DebugBuild Then		    Dim SparkleFrameworkLocation As FolderItem = App.ExecutableFile.Parent.Parent.Parent.Parent.Child("Frameworks").Child("Sparkle.framework")		    Sparkle.Initialize(SparkleFrameworkLocation)		  #Else		    Sparkle.Initialize()		  #EndIf		  		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub HandleError(err As ErrorException)		  //Handle all errors here.		  //Report error to FF		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function ThemeColor(ID As Integer) As Color		  #if targetMacOS then		    dim colorPtr as MemoryBlock		    dim OSErr as Integer		    		    Const depth = 32		    		    Declare Function GetThemeBrushAsColor Lib "Carbon" (inColor as Integer,_		    inDepth as Short, inColorDev as Boolean, outColor as Ptr) as Integer		    		    colorPtr = NewMemoryBlock(6)		    OSErr = GetThemeBrushAsColor(ID, depth, true, colorPtr)		    If OSErr = 0 then Return RGB(colorPtr.UShort(0)\255, colorPtr.UShort(2)\255, colorPtr.UShort(4)\255)		  #Else		    //If windows we want white and blue		    If ID = ListRowColorEven Then		      Return &cFFFFFF		    Else		      Return &cEDF2FD		    End If		  #endif		End Function	#tag EndMethod	#tag Property, Flags = &h0		enc As BCEncryptor	#tag EndProperty	#tag Property, Flags = &h0		arc As BCArchiver	#tag EndProperty	#tag Property, Flags = &h0		DoingEncrypt As Boolean	#tag EndProperty	#tag Property, Flags = &h0		Checker As BCTagger	#tag EndProperty	#tag Property, Flags = &h0		arch As ZipThread	#tag EndProperty	#tag Property, Flags = &h0		CurrentEncryptionType As String	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Expiry Date		#tag EndNote		ed As Date	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Days remaining		#tag EndNote		dr As Integer	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Serial Number		#tag EndNote		sn As String	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Days left		#tag EndNote		dl As Integer	#tag EndProperty	#tag Property, Flags = &h0		Flag As Boolean = False	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Stores the items that are to be encrypted in an array.		#tag EndNote		Items() As Folderitem	#tag EndProperty	#tag Property, Flags = &h0		regName As String	#tag EndProperty	#tag Property, Flags = &h0		Ownership As String = "Undetermined"	#tag EndProperty	#tag Property, Flags = &h0		NotificationFlag As boolean	#tag EndProperty	#tag Property, Flags = &h0		NotificationHandle As memoryBlock	#tag EndProperty	#tag Property, Flags = &h0		Notify_MessageHolder As MemoryBlock	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			False = Registered			True = Demo		#tag EndNote		TrialMode As Boolean = True	#tag EndProperty	#tag Property, Flags = &h0		Growl As GrowlMBS	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Holds the file name (including extension that the output file is going to be called (if the overwrite preference is not in use).		#tag EndNote		CurrentFileName As String	#tag EndProperty	#tag Property, Flags = &h0		currentMimic As FolderItem	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Holds the position of the tag in the current mimicked file that is to be decrypted.		#tag EndNote		CurrentTagLocation As UInt64	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			array of data that needs to be added to the log when it is next opened.		#tag EndNote		PasswordToLog(-1) As String	#tag EndProperty	#tag Property, Flags = &h0		DateToLog(-1) As String	#tag EndProperty	#tag Property, Flags = &h0		EncryptedFilesToLog(-1) As String	#tag EndProperty	#tag Constant, Name = ListRowColorEven, Type = Double, Dynamic = False, Default = \"56", Scope = Public	#tag EndConstant	#tag Constant, Name = ListRowColorOdd, Type = Double, Dynamic = False, Default = \"57\r", Scope = Public	#tag EndConstant	#tag ViewBehavior		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="DoingEncrypt"			Group="Behavior"			InitialValue="0"			Type="Boolean"		#tag EndViewProperty		#tag ViewProperty			Name="CurrentEncryptionType"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="dr"			Group="Behavior"			InitialValue="0"			Type="Integer"		#tag EndViewProperty		#tag ViewProperty			Name="sn"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="dl"			Group="Behavior"			InitialValue="0"			Type="Integer"		#tag EndViewProperty		#tag ViewProperty			Name="RegName"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="Flag"			Group="Behavior"			InitialValue="False"			Type="Boolean"		#tag EndViewProperty		#tag ViewProperty			Name="Ownership"			Group="Behavior"			InitialValue="Undetermined"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="NotificationFlag"			Group="Behavior"			InitialValue="0"			Type="boolean"		#tag EndViewProperty		#tag ViewProperty			Name="TrialMode"			Group="Behavior"			InitialValue="0"			Type="Boolean"		#tag EndViewProperty		#tag ViewProperty			Name="CurrentFileName"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty	#tag EndViewBehaviorEnd Module#tag EndModule